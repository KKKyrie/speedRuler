console.log("speedRuler：insert script => ruler.js");var sendMessage=chrome.runtime.sendMessage,onMessage=chrome.runtime.onMessage,Page={data:{timingArr:[],resourceArr:[]},getTiming:function(e){var n=performance.timing,t={};if((n.loadEventEnd-n.loadEventStart)/1e3<0)return void setTimeout(function(){e.getTiming()},200);t["重定向时间"]=(n.redirectEnd-n.redirectStart)/1e3,t["DNS解析时间"]=(n.domainLookupEnd-n.domainLookupStart)/1e3,t["TCP完成握手时间"]=(n.connectEnd-n.connectStart)/1e3,t["HTTP请求响应完成时间"]=(n.responseEnd-n.requestStart)/1e3,t["DOM开始加载前所花费时间"]=(n.responseEnd-n.navigationStart)/1e3,t["DOM加载完成时间"]=(n.domComplete-n.domLoading)/1e3,t["DOM结构解析完成时间"]=(n.domInteractive-n.domLoading)/1e3,t["脚本加载时间"]=(n.domContentLoadedEventEnd-n.domContentLoadedEventStart)/1e3,t["onload事件时间"]=(n.loadEventEnd-n.loadEventStart)/1e3,t["页面完全加载时间"]=t["重定向时间"]+t["DNS解析时间"]+t["TCP完成握手时间"]+t["HTTP请求响应完成时间"]+t["DOM结构解析完成时间"]+t["DOM加载完成时间"];var r=[];for(var o in t)r.push({name:o,"durations(s)":t[o]});this.data.timingArr=r},getResourceTiming:function(){if(!window.performance&&!window.performance.getEntries)return console.log("浏览器版本过低，不支持performance."),!1;var e=[];window.performance.getEntries().forEach(function(n){e.push({url:n.name,entryType:n.entryType,type:n.initiatorType,"duration(ms)":n.duration})}),this.data.resourceArr=e},initData:function(){this.getTiming(this),this.getResourceTiming()},bindEvent:function(){var e=this;onMessage.addListener(function(n,t,r){0!==e.data.timingArr.length&&0!==e.data.resourceArr.length||(console.log(":)"),e.initData()),"MEASURE"===n.action?(console.table(e.data.timingArr),r("Success")):"RESOURCE"==n.action?(console.table(e.data.resourceArr),r("Success")):(console.error("undefined action"),r("Error"))}),window.addEventListener("load",function(){e.initData()},!1)},init:function(){this.bindEvent()}};Page.init();